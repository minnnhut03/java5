<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<title>Trang Giỏ Hàng</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<!-- Bootstrap Icons CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
/* Hiển thị dropdown khi hover vào nav-item */
.nav-item.dropdown:hover .custom-dropdown {
	display: block;
	opacity: 1;
	transform: translateY(0);
	transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
}

/* Đảm bảo dropdown không bị ẩn khi rê chuột vào dropdown */
.custom-dropdown {
	position: absolute;
	left: 0;
	width: 100vw;
	top: 100%;
	background: white;
	padding: 20px;
	opacity: 0;
	display: none;
	transform: translateY(10px);
	transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
	z-index: 1000;
	border: none;
}

/* Khi hover vào dropdown thì không bị ẩn */
.nav-item.dropdown:hover .custom-dropdown, .custom-dropdown:hover {
	display: block;
	opacity: 1;
	transform: translateY(0);
}

.custom-dropdown .dropdown-header {
	font-weight: bold;
	color: black;
}

.custom-dropdown .dropdown-item {
	color: #555;
	font-size: 14px;
}

.custom-dropdown .dropdown-item:hover {
	color: black;
	background: #f8f9fa;
}

/* Bỏ mũi tên trên dropdown */
.navbar .nav-item .nav-link.no-arrow::after {
	display: none !important;
}

/* Gạch chân khi hover */
.navbar .nav-item .nav-link:hover {
	text-decoration: underline;
}

.search-box {
	display: flex;
	align-items: center;
	border: 1px solid #e0e0e0;
	/* Nhẹ hơn cho cảm giác hiện đại */
	border-radius: 30px;
	/* Tạo góc bo tròn mềm mại */
	padding: 6px 12px;
	/* Tạo khoảng cách gọn gàng */
	width: 200px;
	/* Kích thước phù hợp */
	background-color: #f9f9f9;
	/* Màu nền nhẹ nhàng */
}

.search-box i {
	color: #888;
	/* Màu biểu tượng trung tính */
	font-size: 1.2rem;
	/* Biểu tượng kính lúp rõ hơn */
	margin-right: 8px;
}

.search-box input {
	border: none;
	outline: none;
	flex-grow: 1;
	/* Cho phép ô nhập liệu co giãn */
	font-size: 0.9rem;
	/* Font nhỏ, tinh tế */
	background-color: transparent;
	/* Đồng nhất màu nền */
}

.search-box input::placeholder {
	color: #aaa;
	/* Màu placeholder nhẹ hơn */
}

.search-box:hover {
	border-color: #c5c5c5;
	/* Tạo hiệu ứng khi hover */
}

.search-box i, .navbar a i {
	color: #555;
	/* Màu xám đậm, phù hợp với header */
	transition: color 0.3s ease;
	/* Hiệu ứng mượt */
}

.search-box:hover i, .navbar a:hover i {
	color: #333;
	/* Màu đen nhạt khi hover */
}

.cart-item img {
	width: 100px;
	height: auto;
	border-radius: 10px;
}

.cart-item {
	padding: 15px;
	border-bottom: 1px solid #e5e5e5;
}

.cart-item .item-name {
	font-size: 1.2rem;
	font-weight: bold;
}

.cart-item .item-price, .cart-item .item-quantity {
	font-size: 1rem;
}

.cart-total {
	font-size: 1.5rem;
	font-weight: bold;
}

.footer {
	background-color: #333;
	color: #fff;
	padding: 20px 0;
	margin-top: 20px;
}

.footer h5 {
	font-weight: bold;
	margin-bottom: 10px;
}

.footer ul {
	list-style: none;
	padding: 0;
	margin: 0;
}

.footer li {
	margin-bottom: 10px;
}

.footer a {
	color: #fff;
	text-decoration: none;
}

.footer a:hover {
	color: #ccc;
}

.footer p {
	font-size: 14px;
	margin-bottom: 10px;
}
</style>
</head>

<body>
	<div th:insert="~{user/header :: header}"></div>
	<main class="container my-5">
		<h2 class="text-center mb-4">Giỏ Hàng</h2>
		<div class="row">
			<div class="row">
				<div class="col-12 cart-item">
					<table id="productTable" class="table table-striped table-bordered">
						<thead>
							<tr>
								<th>ID</th>
								<th>Hình ảnh</th>
								<th>Tên sản phẩm</th>
								<th>Size</th>
								<th>Giá</th>
								<th>Số lượng</th>
								<th>Tổng giá</th>
								<th>Hành động</th>
							</tr>
						</thead>
						<tbody>
							<th:block th:each="item : ${cartItems}">
								<tr th:if="${item.product.status}">
									<td th:text="${item.id}"></td>
									<td><img alt="Product Image"
										th:src="@{'/images/' + ${item.product.images[0].name}}"
										style="width: 50px; height: 50px;"></td>
									<td th:text="${item.product.name}"></td>
									<td th:text="${item.size}"></td>
									<td th:text="${#numbers.formatDecimal(item.product.price, 0, 'COMMA', 0, 'POINT')} + ' VND'"></td>
									<td>
										<form action="/updateCart" method="post"
											class="row g-2 align-items-center">


											<div class="col-auto">
												<input class="form-control" name="quantity" type="number"
													th:value="${item.quantity}" step="1" min="1"
													style="max-width: 80px;">
											</div>

											<input type="hidden" name="cartDetailId"
												th:value="${item.id}"> <input type="hidden"
												name="productId" th:value="${item.product.id}">
											<div class="col-auto">
												<button type="submit" class="btn btn-primary update-btn"
													style="display: none;">
													<i class="bi bi-arrow-repeat"></i> Cập nhật
												</button>
											</div>


										</form>

									</td>
									<td th:text="${#numbers.formatDecimal(item.unitPrice, 0, 'COMMA', 0, 'POINT')} + ' VND'"></td>

									<td>
										<div class="d-flex gap-2">
											<!-- Nút Xóa -->
											<form action="/deleteCart" method="post"
												onsubmit="return confirmDelete()">
												<input type="hidden" name="cartDetailId"
													th:value="${item.id}">
												<button type="submit" class="btn btn-danger">Xóa</button>
												<td><input type="checkbox" class="select-item"
													name="selectedItems" th:value="${item.id}"></td>
											</form>
										</div>
									</td>
								</tr>
							</th:block>
						</tbody>
					</table>
					<td>
						<div class="d-flex justify-content-end">
							<form id="checkoutForm" action="/user/order" method="get">
								<input type="hidden" name="selectedItems"
									id="selectedItemsInput">
								<button type="submit" class="btn btn-success">Mua ngay</button>
							</form>
						</div>
					</td>
				</div>
			</div>
		</div>
	</main>
	<div th:insert="~{user/footer :: footer}"></div>

	<!-- Bootstrap JavaScript Libraries -->
	<script
		src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
		integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
		crossorigin="anonymous">
		
	</script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
		integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
		crossorigin="anonymous">
		
	</script>
	<script>
		function confirmDelete() {
		    return confirm("Bạn có chắc chắn muốn xóa sản phẩm này khỏi giỏ hàng?");
		}
		
	    document.addEventListener("DOMContentLoaded", function () {
	        const checkboxes = document.querySelectorAll(".select-item");
	        const checkoutForm = document.getElementById("checkoutForm");
	        const selectedItemsInput = document.getElementById("selectedItemsInput");

	        checkoutForm.addEventListener("submit", function (event) {
	            const selectedItems = Array.from(checkboxes)
	                .filter(checkbox => checkbox.checked)
	                .map(checkbox => checkbox.value)
	                .join(",");

	            if (!selectedItems) {
	                alert("Vui lòng chọn ít nhất một sản phẩm để mua.");
	                event.preventDefault(); // Ngăn form submit nếu không có sản phẩm nào được chọn
	            } else {
	                selectedItemsInput.value = selectedItems;
	            }
	        });
	    });
	
	    document.addEventListener("DOMContentLoaded", function () {
	        const quantityInputs = document.querySelectorAll('input[name="quantity"]');

	        quantityInputs.forEach(input => {
	            input.addEventListener("change", function () {
	                // Tìm form chứa input hiện tại và tự động submit
	                this.closest("form").submit();
	            });
	        });
	    });
	</script>
</body>

</html>
